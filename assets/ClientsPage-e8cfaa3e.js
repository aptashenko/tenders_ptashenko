import{c as Y,o as _,a as p,b as g,t as D,n as I,i as d,F as C,j as N,d as O,u as J}from"./index-945a6258.js";import{u as w}from"./main-store-60c7105d.js";import{u as M}from"./useDateFormat-57ab88d4.js";import"./_commonjsHelpers-725317a4.js";const P={class:"card__id"},x={class:"card__title"},T={__name:"ClientsDashboardCard",props:{item:{type:Object},inWork:{type:Array}},setup(o){const n=o,i=Y(()=>n.inWork.find(c=>c.tenderID===n.item.tenderID));return(c,a)=>(_(),p("li",{class:I(["card",{active:i.value}])},[g("p",P,D(o.item.tenderID),1),g("p",x,D(o.item.title),1)],2))}};const W={class:"clients-page"},$={class:"cards-list"},j={__name:"ClientsPage",setup(o){const{setDateFormat:n}=M(),i=w(),c=d(JSON.parse(localStorage.getItem("favorites"))||[]),a=d(JSON.parse(localStorage.getItem("in_work"))||[]),l=d(JSON.parse(localStorage.getItem("payments"))||[]),u=d(JSON.parse(localStorage.getItem("staff_payments"))||[]),S=t=>t<2e5?1600:t>=2e5&&t<=3e6?2900:6e3,k=[{id:1,name:"Артем П."},{id:2,name:"Дарина Р."}],v=(t,e)=>{if(t!==-1)return a.value.splice(t,1),localStorage.setItem("in_work",JSON.stringify(a.value)),!0;if(e){const s=e;return s.is_paid=!1,s.payment=S(e.value.amount),a.value.push(s),localStorage.setItem("in_work",JSON.stringify(a.value)),s}return!0},y=(t,e)=>{var s;if(t!==-1)return l.value.splice(t,1),u.value.splice(t,1),localStorage.setItem("payments",JSON.stringify(l.value)),localStorage.setItem("staff_payments",JSON.stringify(u.value)),!0;if(e){const m={id:e.id,tenderID:e.tenderID,date:n(new Date,"DD.MM.YYYY"),amount:e.payment,customer:"ТОВ ХХХ",category:"Підготовка тендеру",comment:"за тендер",updated:n(new Date,"DD.MM.YYYY")},r={id:e.tenderID,date:n(e.next_check||e.date,"DD.MM.YYYY"),amount:-700,category:"Підготовка тендеру",customer:((s=k.find(f=>f.id===e.resp_id))==null?void 0:s.name)||"none",comment:`за тендер ${e.tenderID}`,is_paid:!1};return l.value.push(m),u.value.push(r),localStorage.setItem("payments",JSON.stringify(l.value)),localStorage.setItem("staff_payments",JSON.stringify(u.value)),!0}return!0},h=async t=>{const e=a.value.findIndex(r=>r.tenderID===t.tenderID),s=v(e),m=y(e);if(s&&m){const r=await i.getTenderDetails(t.tenderID),f=await v(e,r);y(e,f)}};return(t,e)=>(_(),p("div",W,[g("ul",$,[(_(!0),p(C,null,N(c.value,s=>(_(),O(T,{"in-work":a.value,item:s,class:I({deactivated:J(i).isLoading}),onClick:m=>h(s)},null,8,["in-work","item","class","onClick"]))),256))])]))}};export{j as default};
